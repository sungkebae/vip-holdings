<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ† ì„±ê¸°ë°°ì†Œì¥ ì „ëµ | VIP ë³´ìœ ì¢…ëª©</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#ffffff;--sf:#f5f6f8;--sf2:#ebedf2;--bd:#d8dbe5;--tx:#1a1d27;--ts:#6b7280;--ac:#2563eb;--gn:#059669;--rd:#dc2626;--gl:#d97706}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',-apple-system,sans-serif;background:var(--bg);color:var(--tx);line-height:1.7;font-size:15px}
.ct{max-width:1200px;margin:0 auto;padding:20px 12px 80px}

.hd{text-align:center;margin-bottom:20px;padding:24px 0 16px}
.hb{display:inline-flex;align-items:center;gap:6px;background:rgba(220,38,38,.1);color:var(--rd);padding:6px 14px;border-radius:16px;font-size:14px;font-weight:600;margin-bottom:10px}
.hd h1{font-size:28px;font-weight:900;margin-bottom:4px}
.hd-sub{color:var(--ts);font-size:15px}

.update-bar{display:flex;justify-content:center;align-items:center;gap:8px;margin-bottom:16px;font-size:13px;color:var(--ts)}
.update-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;display:inline-block}

/* í†µê³„ */
.sm{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px}
.sc{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:14px 8px;text-align:center}
.sc .lb{font-size:11px;color:var(--ts);font-weight:500;margin-bottom:2px}
.sc .vl{font-size:22px;font-weight:900}
.sc .sb{font-size:11px;color:var(--ts);margin-top:1px}
.green{color:var(--gn)}.red{color:var(--rd)}.blue{color:var(--ac)}.gold{color:var(--gl)}

/* í•„í„° + ì •ë ¬ */
.ctrl{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap;align-items:center}
.fbtn{background:var(--sf);border:1px solid var(--bd);color:var(--ts);padding:7px 14px;border-radius:6px;font-size:13px;font-family:inherit;cursor:pointer;font-weight:500;transition:all .2s}
.fbtn:hover{border-color:var(--ac);color:var(--tx)}
.fbtn.active{background:var(--ac);border-color:var(--ac);color:white}
.sort-btn{background:white;border:1px solid var(--bd);color:var(--tx);padding:7px 12px;border-radius:6px;font-size:13px;font-family:inherit;cursor:pointer;font-weight:600;transition:all .2s}
.sort-btn:hover{background:var(--sf)}
.sort-btn.on{background:var(--rd);border-color:var(--rd);color:white}
.sep{width:1px;height:24px;background:var(--bd);margin:0 4px}

/* ë³´ìœ /ì´ìµì‹¤í˜„ íƒ­ */
.tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:2px solid var(--bd)}
.tab{padding:10px 20px;font-size:15px;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;color:var(--ts);transition:all .2s}
.tab.active{color:var(--rd);border-bottom-color:var(--rd)}
.tab .cnt{font-size:13px;font-weight:400;margin-left:4px}

/* í…Œì´ë¸” */
.tw{border:1px solid var(--bd);border-radius:10px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.tsc{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;min-width:700px}
thead th{background:var(--sf);padding:10px 8px;font-size:12px;font-weight:700;color:var(--ts);border-bottom:2px solid var(--bd);white-space:nowrap;position:sticky;top:0;text-align:center}
tbody td{padding:10px 8px;font-size:14px;text-align:center;border-bottom:1px solid var(--sf2);white-space:nowrap}
tbody tr:hover{background:rgba(220,38,38,.02)}

.sn{font-weight:800;color:var(--tx);font-size:15px}
.scode{font-size:11px;color:var(--ts);margin-left:4px;font-weight:400}
.dc{color:var(--ts);font-size:13px}
.buy-v{font-weight:600;color:var(--tx)}
.avg-note{font-size:11px;color:var(--ts);display:block}
.cur-v{font-weight:700;color:var(--gl)}
.sell-v{font-weight:600;color:var(--gn)}
.wt{font-size:12px;padding:2px 7px;border-radius:4px;background:rgba(37,99,235,.08);color:var(--ac);font-weight:600}
.nt{font-size:12px;color:var(--ts);max-width:160px;white-space:normal;word-break:keep-all;text-align:left;line-height:1.4}

.rb{display:inline-block;padding:4px 8px;border-radius:5px;font-weight:800;font-size:14px;min-width:64px;text-align:center}
.rb.pos{background:rgba(220,38,38,.08);color:var(--rd)}
.rb.neg{background:rgba(37,99,235,.08);color:var(--ac)}
.rb.neu{background:var(--sf);color:var(--ts)}

.no-data{text-align:center;padding:40px;color:var(--ts);font-size:14px}
.loading{text-align:center;padding:50px;color:var(--ts)}
.loading-spin{display:inline-block;width:24px;height:24px;border:3px solid var(--sf2);border-top-color:var(--rd);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:768px){
.ct{padding:12px 8px 60px}
.hd{padding:16px 0 10px}
.hd h1{font-size:22px}
.sm{grid-template-columns:repeat(2,1fr);gap:6px}
.sc{padding:10px 6px}
.sc .vl{font-size:18px}
table{min-width:600px}
thead th{padding:8px 5px;font-size:11px}
tbody td{padding:8px 5px;font-size:13px}
.sn{font-size:14px}
.rb{font-size:13px;min-width:56px;padding:3px 6px}
.nt{max-width:120px;font-size:11px}
.tab{padding:8px 14px;font-size:14px}
}
</style>
</head>
<body>
<div class="ct">

<div class="hd">
<div class="hb">ğŸ† VIP PORTFOLIO</div>
<h1>ì„±ê¸°ë°°ì†Œì¥ ì „ëµ</h1>
<div class="hd-sub">ë‹¨ê¸°ìŠ¤ìœ™ ì‹œê·¸ë„ Â· VIP ë³´ìœ ì¢…ëª© í˜„í™©</div>
</div>

<div class="update-bar">
<span class="update-dot" id="statusDot"></span>
<span id="updateTime">ë°ì´í„° ë¡œë”© ì¤‘...</span>
</div>

<div class="sm">
<div class="sc"><div class="lb">ë³´ìœ  ì¢…ëª©</div><div class="vl blue" id="totalC">-</div><div class="sb" id="totalS">-</div></div>
<div class="sc"><div class="lb">í‰ê·  ìˆ˜ìµë¥ </div><div class="vl red" id="avgR">-</div><div class="sb" id="avgS">-</div></div>
<div class="sc"><div class="lb">ìˆ˜ìµ ì¢…ëª©</div><div class="vl green" id="profC">-</div><div class="sb" id="profS">-</div></div>
<div class="sc"><div class="lb">ìµœê³  ìˆ˜ìµ</div><div class="vl red" id="maxR">-</div><div class="sb" id="maxS">-</div></div>
</div>

<!-- íƒ­ -->
<div class="tabs">
<div class="tab active" id="tabActive" onclick="switchTab('active')">ë³´ìœ  ì¤‘<span class="cnt" id="tabActiveC"></span></div>
<div class="tab" id="tabClosed" onclick="switchTab('closed')">ì´ìµì‹¤í˜„<span class="cnt" id="tabClosedC"></span></div>
</div>

<!-- í•„í„° + ì •ë ¬ -->
<div class="ctrl" id="ctrlBar">
<div id="filterBtns"></div>
<div class="sep"></div>
<button class="sort-btn" id="sortDate" onclick="toggleSort('date')">ğŸ“… ì¶”ì²œì¼</button>
<button class="sort-btn" id="sortReturn" onclick="toggleSort('return')">ğŸ“Š ìˆ˜ìµë¥ </button>
</div>

<!-- í…Œì´ë¸” -->
<div class="tw"><div class="tsc">
<table>
<thead><tr>
<th>ì¶”ì²œì¼</th>
<th style="text-align:left;padding-right:2px">ì¢…ëª©ëª…</th>
<th style="padding-left:2px">ìˆ˜ìµë¥ </th>
<th>í˜„ì¬ê°€</th>
<th>ë§¤ìˆ˜ê°€</th>
<th style="color:var(--gn)">ë§¤ë„ëª©í‘œ</th>
<th>ë¹„ì¤‘</th>
<th>ë¹„ê³ </th>
</tr></thead>
<tbody id="tb">
<tr><td colspan="8" class="loading"><div class="loading-spin"></div><br>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>
</tbody>
</table>
</div></div>

</div>

<script>
var JSON_URL = './prices.json';
var DATA = null;
var currentTab = 'active';
var currentFilter = 'all';
var currentSort = 'date';   // 'date' or 'return'
var sortAsc = false;         // false = desc (ìµœì‹ /ë†’ì€ìˆœ)

async function loadData() {
  try {
    var resp = await fetch(JSON_URL + '?t=' + Date.now());
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    DATA = await resp.json();
    renderAll();
  } catch (e) {
    console.error(e);
    document.getElementById('tb').innerHTML =
      '<tr><td colspan="8" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
  }
}

function renderAll() {
  if (!DATA) return;
  document.getElementById('statusDot').style.background = '#94a3b8';
  document.getElementById('updateTime').textContent = DATA.updated_at + ' ê¸°ì¤€';

  // íƒ­ ì¹´ìš´íŠ¸
  var active = DATA.holdings.filter(function(h){ return h.is_active; });
  var closed = DATA.holdings.filter(function(h){ return !h.is_active; });
  document.getElementById('tabActiveC').textContent = '(' + active.length + ')';
  document.getElementById('tabClosedC').textContent = '(' + closed.length + ')';

  buildFilters();
  renderStats();
  renderTable();
}

function switchTab(tab) {
  currentTab = tab;
  currentFilter = 'all';
  document.getElementById('tabActive').className = tab === 'active' ? 'tab active' : 'tab';
  document.getElementById('tabClosed').className = tab === 'closed' ? 'tab active' : 'tab';
  buildFilters();
  renderStats();
  renderTable();
}

// â”€â”€ í•„í„° â”€â”€

function buildFilters() {
  var items = getTabItems();
  var months = {};
  items.forEach(function(h) {
    if (h.rec_date) {
      var m = h.rec_date.substring(0, 7);
      months[m] = (months[m] || 0) + 1;
    }
  });

  var sorted = Object.keys(months).sort().reverse();
  var html = '<button class="fbtn ' + (currentFilter === 'all' ? 'active' : '') +
    '" onclick="setFilter(\'all\')">ì „ì²´ ' + items.length + '</button>';
  sorted.forEach(function(m) {
    var parts = m.split('-');
    var label = parts[0].substring(2) + 'ë…„ ' + parseInt(parts[1]) + 'ì›”';
    html += '<button class="fbtn ' + (currentFilter === m ? 'active' : '') +
      '" onclick="setFilter(\'' + m + '\')">' + label + ' ' + months[m] + '</button>';
  });

  document.getElementById('filterBtns').innerHTML = html;
}

function setFilter(f) {
  currentFilter = f;
  buildFilters();
  renderStats();
  renderTable();
}

function getTabItems() {
  if (!DATA) return [];
  return DATA.holdings.filter(function(h) {
    return currentTab === 'active' ? h.is_active : !h.is_active;
  });
}

// â”€â”€ ì •ë ¬ â”€â”€

function toggleSort(type) {
  if (currentSort === type) {
    sortAsc = !sortAsc;
  } else {
    currentSort = type;
    sortAsc = false;
  }
  // ë²„íŠ¼ ìƒíƒœ
  document.getElementById('sortDate').className = 'sort-btn' + (currentSort === 'date' ? ' on' : '');
  document.getElementById('sortReturn').className = 'sort-btn' + (currentSort === 'return' ? ' on' : '');
  // í™”ì‚´í‘œ
  document.getElementById('sortDate').textContent = 'ğŸ“… ì¶”ì²œì¼' + (currentSort === 'date' ? (sortAsc ? ' â–²' : ' â–¼') : '');
  document.getElementById('sortReturn').textContent = 'ğŸ“Š ìˆ˜ìµë¥ ' + (currentSort === 'return' ? (sortAsc ? ' â–²' : ' â–¼') : '');
  renderTable();
}

function sortItems(items) {
  var sorted = items.slice();
  if (currentSort === 'date') {
    sorted.sort(function(a, b) {
      return sortAsc ? (a.rec_date > b.rec_date ? 1 : -1) : (a.rec_date < b.rec_date ? 1 : -1);
    });
  } else {
    sorted.sort(function(a, b) {
      var ra = a.return_pct !== null ? a.return_pct : -9999;
      var rb = b.return_pct !== null ? b.return_pct : -9999;
      return sortAsc ? ra - rb : rb - ra;
    });
  }
  return sorted;
}

// â”€â”€ í†µê³„ â”€â”€

function renderStats() {
  var items = getFilteredItems();
  var tt = 0, cnt = 0, pf = 0, mx = -Infinity, mxN = '';

  items.forEach(function(h) {
    if (h.return_pct !== null) {
      tt += h.return_pct;
      cnt++;
      if (h.return_pct > 0) pf++;
      if (h.return_pct > mx) { mx = h.return_pct; mxN = h.name; }
    }
  });

  document.getElementById('totalC').textContent = items.length + 'ì¢…ëª©';
  document.getElementById('totalS').textContent = currentTab === 'active' ? 'ë³´ìœ  ì¤‘' : 'ì´ìµì‹¤í˜„';

  if (cnt > 0) {
    var av = (tt / cnt).toFixed(2);
    document.getElementById('avgR').textContent = (av >= 0 ? '+' : '') + av + '%';
    document.getElementById('avgR').className = 'vl ' + (av >= 0 ? 'red' : 'blue');
    document.getElementById('avgS').textContent = cnt + 'ì¢…ëª© ê¸°ì¤€';
    document.getElementById('profC').textContent = pf + '/' + cnt;
    document.getElementById('profS').textContent = 'ìŠ¹ë¥  ' + (pf / cnt * 100).toFixed(0) + '%';
    if (mx > -Infinity) {
      document.getElementById('maxR').textContent = '+' + mx.toFixed(2) + '%';
      document.getElementById('maxS').textContent = mxN;
    }
  } else {
    document.getElementById('avgR').textContent = '-';
    document.getElementById('avgS').textContent = '';
    document.getElementById('profC').textContent = '-';
    document.getElementById('profS').textContent = '';
    document.getElementById('maxR').textContent = '-';
    document.getElementById('maxS').textContent = '';
  }
}

function getFilteredItems() {
  var items = getTabItems();
  if (currentFilter !== 'all') {
    items = items.filter(function(h) { return h.rec_date.startsWith(currentFilter); });
  }
  return items;
}

// â”€â”€ í…Œì´ë¸” â”€â”€

function renderTable() {
  var items = getFilteredItems();
  items = sortItems(items);

  if (items.length === 0) {
    document.getElementById('tb').innerHTML =
      '<tr><td colspan="8" class="no-data">í•´ë‹¹ ì¡°ê±´ì˜ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    return;
  }

  var html = '';
  items.forEach(function(h) {
    var buy = h.buy_price || 0;
    var add = h.add_buy || 0;
    var avg = h.avg_price || 0;
    var cur = h.cur_price || 0;

    // ë§¤ìˆ˜ê°€ (ì¶”ê°€ë§¤ìˆ˜ ìˆìœ¼ë©´ í‰ê·  í‘œì‹œ)
    var buyH = '';
    if (avg > 0 && add > 0) {
      buyH = '<span class="buy-v">' + avg.toLocaleString() + '</span>' +
             '<span class="avg-note">' + buy.toLocaleString() + '/' + add.toLocaleString() + '</span>';
    } else if (buy > 0) {
      buyH = '<span class="buy-v">' + buy.toLocaleString() + '</span>';
    } else {
      buyH = '<span style="color:var(--ts)">-</span>';
    }

    // í˜„ì¬ê°€
    var curH = cur > 0 ? '<span class="cur-v">' + cur.toLocaleString() + '</span>' : '<span style="color:var(--ts)">-</span>';

    // ìˆ˜ìµë¥ 
    var retH = '<span class="rb neu">-</span>';
    if (h.return_pct !== null) {
      var r = h.return_pct;
      retH = '<span class="rb ' + (r >= 0 ? 'pos' : 'neg') + '">' + (r >= 0 ? '+' : '') + r.toFixed(2) + '%</span>';
    }

    // ì¶”ì²œì¼ (ì¼ìë§Œ)
    var dayH = '';
    if (h.rec_date && h.rec_date.length >= 10) {
      dayH = '<span class="dc">' + parseInt(h.rec_date.substring(8, 10)) + 'ì¼</span>';
    }

    // ë§¤ë„ëª©í‘œ
    var sellH = h.sell_target ? '<span class="sell-v">' + h.sell_target + '</span>' : '<span style="color:var(--ts)">-</span>';

    // ë¹„ì¤‘
    var wtH = h.weight ? '<span class="wt">' + h.weight + '</span>' : '-';

    // ë¹„ê³ 
    var noteH = h.note ? '<span class="nt">' + h.note + '</span>' : '<span style="color:var(--ts)">-</span>';

    html += '<tr>' +
      '<td>' + dayH + '</td>' +
      '<td style="text-align:left;padding-right:2px"><span class="sn">' + h.name + '</span><span class="scode">' + h.code + '</span></td>' +
      '<td style="padding-left:2px">' + retH + '</td>' +
      '<td>' + curH + '</td>' +
      '<td>' + buyH + '</td>' +
      '<td>' + sellH + '</td>' +
      '<td>' + wtH + '</td>' +
      '<td>' + noteH + '</td>' +
      '</tr>';
  });

  document.getElementById('tb').innerHTML = html;
}

loadData();
</script>
</body>
</html>
