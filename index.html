<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ† ì„±ê¸°ë°°ì†Œì¥ ì „ëµ | ë‹¨ê¸°ìŠ¤ìœ™ ì‹œê·¸ë„</title>
<meta property="og:title" content="ğŸ† ì„±ê¸°ë°°ì†Œì¥ ì „ëµ | ì´ìµì‹¤í˜„ í›„ ë³´ìœ ì¢…ëª©">
<meta property="og:description" content="VIP ìˆ˜ìµì‹¤í˜„ í˜„í™© | ë‹¨ê¸°ìŠ¤ìœ™ ì‹œê·¸ë„ ì „ëµ â€” ì‹¤ì‹œê°„ í˜„ì¬ê°€ ë°˜ì˜">
<meta property="og:type" content="website">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#ffffff;--sf:#f5f6f8;--sf2:#ebedf2;--bd:#d8dbe5;--tx:#1a1d27;--ts:#6b7280;--ac:#2563eb;--gn:#059669;--rd:#dc2626;--gl:#d97706;--pp:#7c3aed}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',-apple-system,sans-serif;background:var(--bg);color:var(--tx);line-height:1.7;font-size:17px}
.ct{max-width:1600px;margin:0 auto;padding:32px 20px 80px}

/* í—¤ë” */
.hd{text-align:center;margin-bottom:32px;padding:40px 0 32px}
.hb{display:inline-flex;align-items:center;gap:6px;background:rgba(217,119,6,.1);color:var(--gl);padding:8px 18px;border-radius:20px;font-size:16px;font-weight:600;margin-bottom:16px}
.hd h1{font-size:48px;font-weight:900;margin-bottom:8px}
.hd-sub{color:var(--ts);font-size:20px}

/* ì—…ë°ì´íŠ¸ ì‹œê° í‘œì‹œ */
.update-bar{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:24px;font-size:15px;color:var(--ts)}
.update-dot{width:10px;height:10px;border-radius:50%;display:inline-block}
.dot-live{background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.5);animation:pulse 2s infinite}
.dot-closed{background:#94a3b8}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* í”„ë¦¬ë¯¸ì—„ ê³µì§€ */
.notice{background:linear-gradient(135deg,#f8f5ff 0%,#ffffff 40%,#f5faf5 100%);border:1px solid rgba(217,119,6,.3);border-radius:20px;padding:40px 36px;margin:24px 0 32px;text-align:center;position:relative;overflow:hidden}
.notice-bar{position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--rd),var(--gl),var(--gn))}
.notice-title{font-size:40px;font-weight:900;margin-bottom:6px;letter-spacing:-1px}
.notice-divider{width:60px;height:3px;background:linear-gradient(90deg,var(--rd),var(--gl));margin:16px auto 20px;border-radius:2px}
.notice-body{font-size:19px;color:#555;line-height:2.2}
.notice-body em{font-style:normal;font-weight:800;font-size:21px}
.notice-body .hl-gold{color:var(--gl)}
.notice-body .hl-red{color:var(--rd)}
.notice-date{margin-top:14px;font-size:18px;color:var(--gl);font-weight:700}
.notice-quote{margin-top:24px;padding-top:20px;border-top:1px solid rgba(217,119,6,.15);font-size:26px;color:var(--gl);font-weight:900;letter-spacing:1px}

/* í†µê³„ ì¹´ë“œ */
.sm{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:12px;margin-bottom:28px}
.sc{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:22px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.sc .lb{font-size:15px;color:var(--ts);font-weight:500;letter-spacing:1px;margin-bottom:6px}
.sc .vl{font-size:34px;font-weight:900}
.sc .sb{font-size:14px;color:var(--ts);margin-top:2px}

/* ìƒ‰ìƒ */
.green{color:var(--gn)}.gold{color:var(--gl)}.blue{color:var(--ac)}.red{color:var(--rd)}

/* í•„í„° ë²„íŠ¼ */
.fb{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.fbtn{background:var(--sf);border:1px solid var(--bd);color:var(--ts);padding:12px 24px;border-radius:8px;font-size:17px;font-family:inherit;cursor:pointer;font-weight:500;transition:all .2s}
.fbtn:hover{border-color:var(--ac);color:var(--tx)}
.fbtn.active{background:var(--ac);border-color:var(--ac);color:white;box-shadow:0 2px 6px rgba(37,99,235,.25)}

/* =============================== */
/* ğŸ”¥ ì‹ ê·œ ë§¤ìˆ˜ ì„¹ì…˜               */
/* =============================== */
.new-section{margin-bottom:32px}
.new-header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.new-badge{background:linear-gradient(135deg,#dc2626,#ea580c);color:white;padding:6px 16px;border-radius:8px;font-size:17px;font-weight:800;letter-spacing:1px}
.new-sub{font-size:16px;color:var(--ts)}
.new-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px}
.new-card{background:linear-gradient(135deg,#fffbeb 0%,#fff 50%,#fef2f2 100%);border:2px solid rgba(220,38,38,.2);border-radius:16px;padding:24px;transition:all .2s;position:relative;overflow:hidden}
.new-card:hover{border-color:var(--rd);box-shadow:0 4px 16px rgba(220,38,38,.1)}
.new-card .nc-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px}
.new-card .nc-name{font-size:22px;font-weight:800}
.new-card .nc-code{font-size:13px;color:var(--ts);margin-left:6px}
.new-card .nc-date{font-size:14px;color:var(--ts);background:var(--sf);padding:3px 10px;border-radius:4px}
.new-card .nc-prices{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.new-card .nc-p{text-align:center;padding:10px;border-radius:8px;background:rgba(255,255,255,.8)}
.new-card .nc-p-label{font-size:13px;color:var(--ts);margin-bottom:2px}
.new-card .nc-p-value{font-size:18px;font-weight:700}
.new-card .nc-ret{text-align:center;padding:12px;border-radius:10px;font-size:24px;font-weight:900}
.nc-ret.pos{background:rgba(220,38,38,.06);color:var(--rd)}
.nc-ret.neg{background:rgba(37,99,235,.06);color:var(--ac)}
.nc-ret.neu{background:var(--sf);color:var(--ts)}
.new-card .nc-sells{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
.nc-sell-tag{font-size:13px;padding:4px 10px;border-radius:4px;background:rgba(0,0,0,.05);color:var(--tx);font-weight:600}

/* í…Œì´ë¸” */
.section-header{display:flex;align-items:center;gap:10px;margin:28px 0 16px}
.section-badge{padding:6px 16px;border-radius:8px;font-size:17px;font-weight:800;letter-spacing:1px}
.badge-active{background:rgba(37,99,235,.1);color:var(--ac)}
.badge-closed{background:rgba(107,114,128,.1);color:var(--ts)}

.tw{background:var(--sf);border:1px solid var(--bd);border-radius:12px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.tsc{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:17px}
thead th{background:var(--sf2);padding:18px 14px;text-align:center;font-weight:600;font-size:15px;color:var(--ts);letter-spacing:.5px;border-bottom:1px solid var(--bd);white-space:nowrap;position:sticky;top:0;z-index:10}
thead th.sell-hd{color:var(--gn)}
tbody td{padding:16px 14px;border-bottom:1px solid rgba(216,219,229,.6);vertical-align:middle;white-space:nowrap;text-align:center}
tbody tr{transition:background .15s}
tbody tr:hover{background:rgba(37,99,235,.04)}
tbody tr:last-child td{border-bottom:none}
.rn{color:var(--tx);font-size:16px;font-weight:500}
.sn{font-weight:700;color:var(--tx);font-size:18px}
.scode{font-size:13px;color:var(--tx);margin-left:4px}
.dc{color:var(--tx);font-size:17px}
.avg-v{font-weight:700;color:var(--tx);font-size:17px}
.rb{display:inline-flex;align-items:center;padding:6px 12px;border-radius:6px;font-size:18px;font-weight:800;min-width:90px;justify-content:center;background:transparent}
.rb.pos{color:var(--rd)}.rb.neg{color:var(--ac)}.rb.neu{color:var(--ts)}
.wt{display:inline-block;background:rgba(37,99,235,.08);color:var(--ac);padding:5px 12px;border-radius:4px;font-size:16px;font-weight:600}
.nt{font-size:14px;color:var(--tx);max-width:150px;white-space:normal;line-height:1.4;text-align:left}
.mh td{background:var(--sf2);padding:16px 14px;font-weight:700;font-size:18px;color:var(--ac);border-bottom:1px solid var(--bd);text-align:left}

/* ë¡œë”© */
.loading{text-align:center;padding:60px;color:var(--ts);font-size:18px}
.loading-spin{display:inline-block;width:32px;height:32px;border:3px solid var(--bd);border-top-color:var(--ac);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}

/* í‘¸í„° */
.ft{text-align:center;padding:32px 0;color:var(--ts);font-size:14px;margin-top:32px}

@media(max-width:768px){
.ct{padding:16px 10px 60px}
.hd h1{font-size:30px}
.notice{padding:24px 18px}
.notice-title{font-size:28px}
.notice-body{font-size:16px}
.notice-body em{font-size:18px}
.notice-quote{font-size:20px}
.sm{grid-template-columns:repeat(2,1fr);gap:8px}
.sc .vl{font-size:24px}
.new-grid{grid-template-columns:1fr}
thead th,tbody td{padding:12px 7px;font-size:14px}
.rb{font-size:14px;min-width:65px;padding:4px 6px}
.sn{font-size:16px}
.new-card .nc-name{font-size:19px}
.new-card .nc-ret{font-size:20px}
}
</style>
</head>
<body>
<div class="ct">

<div class="hd" style="border-bottom:none;padding-bottom:0;margin-bottom:0">
<div class="hb">ğŸ† PROFIT REALIZED</div>
<h1>ğŸ–ï¸ ì„±ê¸°ë°°ì†Œì¥ ì „ëµ | ë‹¨ê¸°ìŠ¤ìœ™ ì‹œê·¸ë„</h1>
<div class="hd-sub">2025.12 ~ 2026.02</div>
</div>

<!-- ì—…ë°ì´íŠ¸ ì‹œê° -->
<div class="update-bar">
<span class="update-dot dot-closed" id="statusDot"></span>
<span id="updateTime">ë°ì´í„° ë¡œë”©ì¤‘...</span>
</div>

<!-- í”„ë¦¬ë¯¸ì—„ ê³µì§€ -->
<div class="notice">
<div class="notice-bar"></div>
<div class="notice-title">ìˆ˜ìµì‹¤í˜„ í›„ ë³´ìœ ì¢…ëª©</div>
<div class="notice-divider"></div>
<div class="notice-body">
ìˆ˜ìµì‹¤í˜„ ì‹œì ì€ <em class="hl-gold">ìˆ˜ìµì´ ê·¹ëŒ€í™”ëœ êµ¬ê°„</em>ì´ë©°<br>
ì§€ê¸ˆ í˜„ì¬ê°€ëŠ” <em class="hl-red">30% ë¬¼ëŸ‰ ë³´ìœ  ìƒíƒœ</em>ì˜ í˜„ì¬ê°€ ìˆ˜ìµë¥ ì…ë‹ˆë‹¤
</div>
<div class="notice-date">â€» í˜„ì¬ê°€ëŠ” ìë™ ê°±ì‹ ë©ë‹ˆë‹¤ (ì¥ì¤‘ 3ë¶„ ì£¼ê¸°)</div>
<div class="notice-quote">" ëŒ€ë°•ìˆ˜ìµì€ ì¸ë‚´ì—ì„œ ë‚˜ì˜¨ë‹¤ "</div>
</div>

<!-- í†µê³„ ì¹´ë“œ -->
<div class="sm">
<div class="sc"><div class="lb">ì´ ì´ìµì‹¤í˜„</div><div class="vl gold" id="totalC">-</div><div class="sb" id="totalS">ë¡œë”©ì¤‘</div></div>
<div class="sc"><div class="lb">í‰ê·  ìˆ˜ìµë¥ </div><div class="vl red" id="avgR">-</div><div class="sb" id="avgS">ê³„ì‚°ì¤‘</div></div>
<div class="sc"><div class="lb">ìˆ˜ìµ ì¢…ëª©</div><div class="vl red" id="profC">-</div><div class="sb" id="profS">ê³„ì‚°ì¤‘</div></div>
<div class="sc"><div class="lb">ìµœê³  ìˆ˜ìµë¥ </div><div class="vl red" id="maxR">-</div><div class="sb" id="maxS">ê³„ì‚°ì¤‘</div></div>
</div>

<!-- í•„í„° ë²„íŠ¼ -->
<div class="fb" id="filterBtns"></div>

<!-- ğŸ”¥ ì‹ ê·œ ë§¤ìˆ˜ ì„¹ì…˜ -->
<div class="new-section" id="newSection" style="display:none">
<div class="new-header">
<span class="new-badge">ğŸ”¥ ì‹ ê·œ ë§¤ìˆ˜</span>
<span class="new-sub" id="newSub">ìµœê·¼ 7ì¼ ì´ë‚´ ì¶”ì²œ</span>
</div>
<div class="new-grid" id="newGrid"></div>
</div>

<!-- ğŸ“Š ë³´ìœ  ì¤‘ í…Œì´ë¸” -->
<div class="section-header" id="activeHeader" style="display:none">
<span class="section-badge badge-active">ğŸ“Š ë³´ìœ  ì¤‘</span>
<span style="font-size:16px;color:var(--ts)" id="activeSub"></span>
</div>
<div class="tw"><div class="tsc">
<table>
<thead><tr>
<th>#</th>
<th style="text-align:left">ì¢…ëª©ëª…</th>
<th>ì¶”ì²œì¼</th>
<th>ë§¤ìˆ˜ê°€</th>
<th>ì¶”ê°€ë§¤ìˆ˜</th>
<th>í‰ê· ë‹¨ê°€</th>
<th>í˜„ì¬ê°€</th>
<th>ìˆ˜ìµë¥ </th>
<th class="sell-hd">1ì°¨ ë§¤ë„</th>
<th class="sell-hd">2ì°¨ ë§¤ë„</th>
<th class="sell-hd">30% ë³´ìœ </th>
<th>ë¹„ì¤‘</th>
<th>ë¹„ê³ </th>
</tr></thead>
<tbody id="tb">
<tr><td colspan="13" class="loading"><div class="loading-spin"></div><br>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>
</tbody>
</table>
</div></div>

<!-- âœ… ì „ëŸ‰ ì´ìµì‹¤í˜„ ì™„ë£Œ -->
<div class="section-header" id="closedHeader" style="display:none">
<span class="section-badge badge-closed">âœ… ì „ëŸ‰ ì´ìµì‹¤í˜„ ì™„ë£Œ</span>
<span style="font-size:16px;color:var(--ts)" id="closedSub"></span>
</div>
<div class="tw" id="closedTable" style="display:none;margin-top:0"><div class="tsc">
<table>
<thead><tr>
<th>#</th>
<th style="text-align:left">ì¢…ëª©ëª…</th>
<th>ì¶”ì²œì¼</th>
<th>ë§¤ìˆ˜ê°€</th>
<th>ì¶”ê°€ë§¤ìˆ˜</th>
<th>í‰ê· ë‹¨ê°€</th>
<th>í˜„ì¬ê°€</th>
<th>ìˆ˜ìµë¥ </th>
<th class="sell-hd">1ì°¨ ë§¤ë„</th>
<th class="sell-hd">2ì°¨ ë§¤ë„</th>
<th class="sell-hd">ê²°ê³¼</th>
<th>ë¹„ì¤‘</th>
<th>ë¹„ê³ </th>
</tr></thead>
<tbody id="tbClosed"></tbody>
</table>
</div></div>

<div class="ft">
<div>ğŸ–ï¸ ì„±ê¸°ë°°ì†Œì¥ ì „ëµ | ë‹¨ê¸°ìŠ¤ìœ™ ì‹œê·¸ë„</div>
<div style="margin-top:4px">í‰ê· ë‹¨ê°€ = (ë§¤ìˆ˜ê°€ + ì¶”ê°€ë§¤ìˆ˜ê°€) Ã· 2 | ìˆ˜ìµë¥  = (í˜„ì¬ê°€ âˆ’ í‰ê· ë‹¨ê°€) Ã· í‰ê· ë‹¨ê°€</div>
</div>

</div>

<script>
// ============================================================
// JSON ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
// ============================================================

// GitHub Pagesì—ì„œ JSON ë¡œë“œ (ê°™ì€ ì €ì¥ì†Œì˜ prices.json)
// ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” './prices.json' ì‚¬ìš©
const JSON_URL = './prices.json';

let DATA = null;
let currentFilter = 'all';

async function loadData() {
  try {
    const resp = await fetch(JSON_URL + '?t=' + Date.now()); // ìºì‹œ ë°©ì§€
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    DATA = await resp.json();
    renderAll();
    updateStatus();
  } catch (e) {
    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
    document.getElementById('tb').innerHTML =
      '<tr><td colspan="13" style="padding:40px;text-align:center;color:var(--ts)">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</td></tr>';
  }
}

function updateStatus() {
  if (!DATA) return;
  const dot = document.getElementById('statusDot');
  const timeEl = document.getElementById('updateTime');

  if (DATA.market_open) {
    dot.className = 'update-dot dot-live';
    timeEl.textContent = 'ì¥ì¤‘ ì‹¤ì‹œê°„ Â· ë§ˆì§€ë§‰ ê°±ì‹  ' + DATA.updated_at;
  } else {
    dot.className = 'update-dot dot-closed';
    timeEl.textContent = 'ì¥ ë§ˆê° Â· ' + DATA.updated_at + ' ê¸°ì¤€';
  }
}

// ============================================================
// í•„í„° ë²„íŠ¼ ìƒì„±
// ============================================================

function buildFilters() {
  if (!DATA) return;
  const months = {};
  DATA.holdings.forEach(h => {
    const m = h.rec_date.substring(0, 7);
    months[m] = (months[m] || 0) + 1;
  });

  const fb = document.getElementById('filterBtns');
  let html = `<button class="fbtn active" onclick="flt('all',this)">ì „ì²´ (${DATA.total_count})</button>`;

  Object.keys(months).sort().reverse().forEach(m => {
    const [y, mm] = m.split('-');
    const label = parseInt(mm) + 'ì›”';
    html += `<button class="fbtn" onclick="flt('${m}',this)">${label} (${months[m]})</button>`;
  });

  fb.innerHTML = html;
}

function flt(m, btn) {
  currentFilter = m;
  document.querySelectorAll('.fbtn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderAll();
}

// ============================================================
// ë Œë”ë§
// ============================================================

function renderAll() {
  if (!DATA) return;
  buildFilters();
  renderStats();
  renderNewStocks();
  renderActiveTable();
  renderClosedTable();
}

function renderStats() {
  const all = DATA.holdings.filter(h => {
    if (currentFilter !== 'all') return h.rec_date.startsWith(currentFilter);
    return true;
  });

  let tt = 0, cnt = 0, pf = 0, mx = -Infinity, mxN = '';
  all.forEach(h => {
    if (h.return_pct !== null) {
      tt += h.return_pct;
      cnt++;
      if (h.return_pct > 0) pf++;
      if (h.return_pct > mx) { mx = h.return_pct; mxN = h.name; }
    }
  });

  document.getElementById('totalC').textContent = all.length + 'ê±´';
  document.getElementById('totalS').textContent = '2025.12 ~ 2026.02';

  if (cnt > 0) {
    const av = (tt / cnt).toFixed(2);
    document.getElementById('avgR').textContent = (av >= 0 ? '+' : '') + av + '%';
    document.getElementById('avgS').textContent = cnt + 'ì¢…ëª© ê¸°ì¤€';
    document.getElementById('profC').textContent = pf + '/' + cnt;
    document.getElementById('profS').textContent = 'ìŠ¹ë¥  ' + (pf / cnt * 100).toFixed(0) + '%';
    document.getElementById('maxR').textContent = '+' + mx.toFixed(2) + '%';
    document.getElementById('maxS').textContent = mxN;
  }
}

// ============================================================
// ğŸ”¥ ì‹ ê·œ ë§¤ìˆ˜ ì¹´ë“œ
// ============================================================

function renderNewStocks() {
  const newStocks = DATA.holdings.filter(h => h.is_new && h.is_active);

  const section = document.getElementById('newSection');
  const grid = document.getElementById('newGrid');

  if (currentFilter !== 'all' || newStocks.length === 0) {
    section.style.display = 'none';
    return;
  }

  section.style.display = 'block';
  document.getElementById('newSub').textContent = `ìµœê·¼ ${DATA.new_stock_days}ì¼ ì´ë‚´ ì¶”ì²œ Â· ${newStocks.length}ì¢…ëª©`;

  let html = '';
  newStocks.forEach(h => {
    const avg = h.avg_price;
    const cur = h.cur_price;
    const ret = h.return_pct;
    const retClass = ret === null ? 'neu' : (ret >= 0 ? 'pos' : 'neg');
    const retText = ret === null ? '-' : (ret >= 0 ? '+' : '') + ret.toFixed(2) + '%';

    let sellTags = '';
    if (h.sell_1) sellTags += `<span class="nc-sell-tag">1ì°¨ ${h.sell_1}</span>`;
    if (h.sell_2) sellTags += `<span class="nc-sell-tag">2ì°¨ ${h.sell_2}</span>`;
    if (h.sell_3) sellTags += `<span class="nc-sell-tag">${h.sell_3}</span>`;

    html += `
    <div class="new-card">
      <div class="nc-top">
        <div><span class="nc-name">${h.name}</span><span class="nc-code">${h.code}</span></div>
        <span class="nc-date">${h.rec_date.substring(5)}</span>
      </div>
      <div class="nc-prices">
        <div class="nc-p"><div class="nc-p-label">í‰ê· ë‹¨ê°€</div><div class="nc-p-value">${avg > 0 ? avg.toLocaleString() + 'ì›' : '-'}</div></div>
        <div class="nc-p"><div class="nc-p-label">í˜„ì¬ê°€</div><div class="nc-p-value" style="color:var(--gl)">${cur > 0 ? cur.toLocaleString() + 'ì›' : '-'}</div></div>
      </div>
      <div class="nc-ret ${retClass}">${retText}</div>
      <div class="nc-sells">${sellTags}</div>
    </div>`;
  });

  grid.innerHTML = html;
}

// ============================================================
// ğŸ“Š ë³´ìœ  ì¤‘ í…Œì´ë¸”
// ============================================================

function renderActiveTable() {
  let items = DATA.holdings.filter(h => h.is_active);
  if (currentFilter !== 'all') {
    items = DATA.holdings.filter(h => h.is_active && h.rec_date.startsWith(currentFilter));
  }

  // ì‹ ê·œ ë§¤ìˆ˜ì— ì´ë¯¸ í‘œì‹œëœ ì¢…ëª©ì€ ì œì™¸ (ì „ì²´ ë³´ê¸°ì—ì„œë§Œ)
  let excludeNew = new Set();
  if (currentFilter === 'all') {
    DATA.holdings.filter(h => h.is_new && h.is_active).forEach(h => excludeNew.add(h.code));
  }
  const tableItems = items.filter(h => !excludeNew.has(h.code));

  const header = document.getElementById('activeHeader');
  const sub = document.getElementById('activeSub');
  if (tableItems.length > 0) {
    header.style.display = 'flex';
    sub.textContent = `ì´ìµì‹¤í˜„ í›„ ì”ì—¬ ë³´ìœ  Â· ${tableItems.length}ì¢…ëª©`;
  } else {
    header.style.display = 'none';
  }

  const tb = document.getElementById('tb');
  if (tableItems.length === 0) {
    tb.innerHTML = '<tr><td colspan="13" style="padding:30px;text-align:center;color:var(--ts)">í•´ë‹¹ ê¸°ê°„ ë³´ìœ ì¢…ëª© ì—†ìŒ</td></tr>';
    return;
  }

  const months = {'2026-02':'ğŸ“… 2026ë…„ 2ì›”','2026-01':'ğŸ“… 2026ë…„ 1ì›”','2025-12':'ğŸ“… 2025ë…„ 12ì›”'};
  let html = '', cm = '';

  tableItems.forEach((h, i) => {
    const m = h.rec_date.substring(0, 7);
    if (m !== cm && currentFilter === 'all') {
      cm = m;
      html += `<tr class="mh"><td colspan="13">${months[m] || m}</td></tr>`;
    }
    html += buildRow(h, i + 1);
  });

  tb.innerHTML = html;
}

// ============================================================
// âœ… ì „ëŸ‰ ì´ìµì‹¤í˜„ ì™„ë£Œ í…Œì´ë¸”
// ============================================================

function renderClosedTable() {
  let items = DATA.holdings.filter(h => !h.is_active);
  if (currentFilter !== 'all') {
    items = DATA.holdings.filter(h => !h.is_active && h.rec_date.startsWith(currentFilter));
  }

  const header = document.getElementById('closedHeader');
  const sub = document.getElementById('closedSub');
  const tableDiv = document.getElementById('closedTable');

  if (items.length > 0) {
    header.style.display = 'flex';
    tableDiv.style.display = 'block';
    sub.textContent = `${items.length}ì¢…ëª©`;
  } else {
    header.style.display = 'none';
    tableDiv.style.display = 'none';
    return;
  }

  const tb = document.getElementById('tbClosed');
  let html = '';
  items.forEach((h, i) => {
    html += buildRow(h, i + 1);
  });
  tb.innerHTML = html;
}

// ============================================================
// í…Œì´ë¸” í–‰ ë¹Œë”
// ============================================================

function buildRow(h, num) {
  const buy = h.buy_price || 0;
  const add = h.add_buy || 0;
  const avg = h.avg_price || 0;
  const cur = h.cur_price || 0;

  const buyH = buy > 0 ? `<span style="font-weight:600">${buy.toLocaleString()}</span>` : '<span style="color:var(--ts)">-</span>';
  const addH = add > 0 ? `<span style="font-weight:600">${add.toLocaleString()}</span>` : '<span style="color:var(--ts)">-</span>';
  const avgH = avg > 0 ? `<span class="avg-v">${avg.toLocaleString()}ì›</span>` : '<span style="color:var(--ts)">-</span>';
  const curH = cur > 0 ? `<span style="color:var(--gl);font-weight:600">${cur.toLocaleString()}</span>` : '<span style="color:var(--ts)">-</span>';

  let retH = '<span class="rb neu">-</span>';
  if (h.return_pct !== null) {
    const r = h.return_pct;
    retH = `<span class="rb ${r >= 0 ? 'pos' : 'neg'}">${r >= 0 ? '+' : ''}${r.toFixed(2)}%</span>`;
  }

  const s1H = h.sell_1 ? `<span style="font-weight:600">${h.sell_1}</span>` : '<span style="color:var(--ts)">-</span>';
  const s2H = h.sell_2 ? `<span style="font-weight:600">${h.sell_2}</span>` : '<span style="color:var(--ts)">-</span>';

  let s3H = '<span style="color:var(--ts)">-</span>';
  if (h.sell_3) {
    if (h.sell_3.includes('ì „ëŸ‰ì´ìµì‹¤í˜„')) s3H = `<span style="font-weight:700">${h.sell_3}</span>`;
    else s3H = `<span style="font-weight:600">${h.sell_3}</span>`;
  }

  return `<tr>
<td class="rn">${num}</td>
<td style="text-align:left"><span class="sn">${h.name}</span><span class="scode">${h.code}</span></td>
<td class="dc">${h.rec_date.substring(5)}</td>
<td>${buyH}</td>
<td>${addH}</td>
<td>${avgH}</td>
<td>${curH}</td>
<td>${retH}</td>
<td>${s1H}</td>
<td>${s2H}</td>
<td>${s3H}</td>
<td><span class="wt">${h.weight}</span></td>
<td class="nt">${h.note || '-'}</td>
</tr>`;
}

// ============================================================
// ì´ˆê¸° ë¡œë“œ + ìë™ ê°±ì‹ 
// ============================================================

loadData();

// ì¥ì¤‘ì´ë©´ 3ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ 
setInterval(() => {
  if (DATA && DATA.market_open) {
    loadData();
  }
}, 180000);
</script>
</body>
</html>
